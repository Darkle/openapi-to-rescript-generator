module Api = {
{{#each paths}}
  {{setVariable 'apiPath' @key}}
  {{!-- each "this" will be a http verb. e.g. "get"  --}}
  {{#each this}}
    module {{capitalize this.operationId}} = {
      let apiPath = "{{@root.apiPath}}"
      let httpVerb = "{{@key}}"
      {{!-- {{setVariable 'pathVerbOperationId' @key @root.apiPath this.operationId }} --}}

      {{!-- https://swagger.io/specification/#parameter-object --}}
      {{#if (paramContainsParamType 'path' parameters)}}
        module PathParams = {
          {{#each parameters}}
            {{#if (eq in 'path')}}
              {{#if schema.enum}}
                type {{name}} = {{#unless required}}option<{{/unless}}{{stringEnumToPolyVariant schema.enum}}{{#unless required}}>{{/unless}}
              {{else}}
                type {{name}} = {{#unless required}}option<{{/unless}}{{schema.type}}{{#unless required}}>{{/unless}}
              {{/if}}
            {{/if}}
          {{/each}}
        }
      {{/if}}

      {{#if (paramContainsParamType 'query' parameters)}}
        module QueryParams = {
          {{#each parameters}}
            {{#if (eq in 'query')}}
              {{#if schema.enum}}
                type {{name}} = {{#unless required}}option<{{/unless}}{{stringEnumToPolyVariant schema.enum}}{{#unless required}}>{{/unless}}
              {{else}}
                type {{name}} = {{#unless required}}option<{{/unless}}{{schema.type}}{{#unless required}}>{{/unless}}
              {{/if}}
            {{/if}}
          {{/each}}
        }
      {{/if}}

      {{!-- {{#if requestBody}}
        type body = {
          {{#each requestBody}}
            {{content.schema}}
            {{key}}: {{type}}\n
          {{/each}}
        }
      {{/if}} --}}

      {{#each responses}}
        {{#each content}}
          {{!-- Can have empty responses so check if schema truthy --}}
          {{#if schema}}
            let {{../../operationId}}Response = {{{structify schema}}}
          {{/if}}
        {{/each}}
      {{/each}}
    }
  {{/each}}
{{/each}}
}